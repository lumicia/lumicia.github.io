---
title: "Python 正则表达式模块 re"
date: 2021-06-20T09:53:15+08:00
categories: ["Python"]
tags: ["正则表达式"]
draft: false
---

正则表达式可以指定匹配字符串的模式，从而执行对字符串的 ** 搜索 ** 和 ** 替换 **。

Python 通过内置的 `re` 模块来支持正则表达式。

模式和要搜索的字符串可以是 Unicode 字符串（`str`），也可以是 8 位的字节串（`bytes`），但二者不能混用。替换字符串的类型页必须与所用的模式和搜索字符串类型一致。

在 Python 中，正则表达式模式通常使用原始字符串 `r'...'` 的形式来表示。这样就不必对反斜杠 `\` 做特殊处理。

<!--more-->

```python
import re
```

`re` 的 5 个常用标志常量：

- `re.IGNORECASE` / `re.I`：忽略正则表达式的大小写；
- `re.ASCII` / `re.A`：只匹配 ASCII 字符；
- `re.DOTALL` / `re.S`：`.` 匹配包括换行符在内的所有字符；
- `re.MULTILINE` / `re.M`：可以让 `^` 匹配行开始，`$` 匹配行结尾；
- `re.VERBOSE` / `re.X`：详细模式可以在正则表达式中添加注释，提高可读性。

## 查找

### 查找一个匹配项

只返回一个匹配对象：

- `re.search`：查找任意位置的匹配项，返回第一个匹配的对象；
- `re.match`：只匹配字符串开始的位置；
- `re.fullmatch`：整个字符串完全匹配正则表达式模式。

然后通过匹配对象的 `.group()` 方法获取匹配值。参数值为 `0` 或没有参数，表示整个匹配；参数值为 `1` 到 `99`，返回对应字符串；参数有多个，则返回元组，每个参数对应一个项。可以使用 `[g]` 语法糖来替代 `.group(g)` 方法。

### 查找多个匹配项

返回多个匹配对象：

- `re.findall`：从字符串任意位置查找，返回一个列表；
- `re.finditer`：从字符串任意位置查找，返回一个迭代器。

## 分割

`re.split`：用指定模式分割字符串，还可以指定最大分割次数和标志。

与 `str.split` 相比，数据量大时更快，数据量小时更慢。

## 替换

`re.sub`：指定一个替换字符串或函数，替换目标字符串中匹配的字符，还可以指定最大替换次数和标志。

`re.subn`：类似于 `re.sub` 函数，但返回一个元组而非字符串。元组包括字符串和替换次数两个项。

## 编译

`re.compile` 将正则表达式的模式编译为一个正则表达式对象。这个对象具有与 `re` 模块相同的正则函数，用于匹配。

```python
prog = re.compile(pattern)
result = prog.match(string)

// 等价于
result = re.match(pattern, string)
```

正则表达式对象的方法可以在字符串中指定起始位置开始搜索，指定结尾位置结束搜索。

正则表达式对象可以复用，来缓存编译后的函数。

## 其他

`re.escape`：转义模式中的特殊字符。

`re.purge`：清除正则表达式的缓存。
